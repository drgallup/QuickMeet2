
<!DOCTYPE html>
<html ng-app="MyApp">
<header>
  <link rel="stylesheet" href="css/menu.css">
  <div class="container">
          <ul class="navigation">
              <li class="navigation-items"> <a href="/index.html">Home</a> </li>
              <li class="navigation-items"> <a ng-controller="PopCtrl" ng-click="showHelp($event)">Help</a> </li>
          </ul>
  </div>
</header>


  <link rel="stylesheet" href="css/calendar.css">
      <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
  <section layout="row" flex-offset="5" align="center" >
  <div>
  <h1>QuickMeet</h1>
  <div id = "cal"> 
  <body onload="displayUsersOfGroup()" >
    <!-- Lists days over grid-->
    <table class="header">
      <tr>
        <td></td>
        <td>Sunday</td>
        <td>Monday</td>
        <td>Tuesday</td>
        <td>Wednesday</td>
        <td>Thursday</td>
        <td>Friday</td>
        <td>Saturday</td>
      </tr>
    </table>

    <canvas id="myCanvas" width="800" height="400">
    Your browser does not support the HTML5 canvas tag.
    </canvas>
    </div>

    <form>
      <md-button class="md-primary md-raised" onclick = "userRedirect()" ng-hide=true>
        Go to user page
      </md-button>
        
      <md-input-container>
        <font size="4">Add User To Group:</font>
        <input aria-label="username" id= "name1" type="text" name="username" value="" md-autofocus>
      </md-input-container>
     
      <md-button class="md-primary md-raised" onclick ="realHelperAddUserToGroup();">
        Add
      </md-button>
          
      <md-button class="md-primary md-raised" onclick = "genPDF()">
        Generate PDF
      </md-button>
      
      <!-- login alert -->
      <md-button ng-controller="PopCtrl" class="md-primary md-raised" ng-click="showAlert($event)" ng-hide=false  >
        Login
      </md-button>
        
    </form>  
    </div>
    <md-sidenav
        class="md-sidenav-left"
        style="margin-top: 75px; padding-bottom: 100px"
        md-component-id="left"
        md-is-locked-open="$mdMedia('gt-md')"
        md-whiteframe="4" flex-offset="10">

      <md-toolbar class="md-theme-indigo">
        <h2 class="md-toolbar-tools">Users</h2>
      </md-toolbar>
      <md-content layout-padding ng-controller="GroupCtrl">
      </md-content>


      <h3 ng-controller="ListUsers">
        <div ng-repeat="x in listOfUsers">
          {{x}}
        </div>
      </h3>
    </md-sidenav>
    </section>      
  </body>
    
      <!-- Angular Material requires Angular.js Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>

  <!-- Angular Material Library -->
  <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
  
  <!-- Add our Source Files here -->
  <script src="js/angularController.js"></script>

  <!-- JQuery, jsPDF and html2canvas Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
  <script src="js/html2canvas.js"></script>

    <!-- Script sources: add yours here -->
    <script src ="js/db.js"></script>
    
    <script src ="js/pdfGenerator.js"></script>

    <script src ="js/groupDB.js"></script>
    <script src = "js/redir.js"> </script>
    <script src ="js/CalendarGenerator.js"></script>
    <script src ="js/angularController.js"></script>

    <script src = "js/CoordinateTracker.js"></script>

    <script src ="js/BoxGenerator.js"></script>
    
    <script src ="js/undo.js"></script>
    
    <script src ="js/coordinateHelper.js"></script>
    
    <!-- Login HTML file -->
    <script type="text/ng-template" id="dialog1.login.html">
      <md-dialog aria-label="Login Page">
        <form ng-cloak>
          <md-toolbar>
            <div class="md-toolbar-tools">
              <h2>Login Page</h2>
              <span flex></span>
              <md-button class="md-icon-button" ng-click="cancel()">
                <md-icon md-svg-src="img/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon>
              </md-button>
            </div>
          </md-toolbar>

          <md-dialog-content>
            <div class="md-dialog-content">
              <h2>Welcome to QuickMeet</h2>
              <p>
                Enter your username. If you don't have one, click new user.
              </p>
              
              <md-input-container>
                <font size="4">Username:</font>
                <input aria-label="username" id= "name" type="text" name="username" value="" md-autofocus>
              </md-input-container>
              
              <md-input-container ng-hide=true>
                <font size="4">Name:</font>
                <input aria-label="name" type="text" value="">
              </md-input-container>
              
              
            </div>
          </md-dialog-content>

          <md-dialog-actions layout="row">
            <md-button ng-click="cancel()">
              Cancel
            </md-button>
            <span flex></span>
            <md-button ng-click="answer('New User')" onclick="newUserCreation()">
             New User
            </md-button>
            <md-button ng-click="answer('Returning User')" onclick="returningUserCreation()">
              Returning User
            </md-button>
          </md-dialog-actions>
        </form>
        
      </md-dialog>
      
    <script  src ="js/db.js"></script>
    </script>

    <!-- help dialog -->
    <script type="text/ng-template" id="dialog1.help.html">
    <md-dialog aria-label="Help">
        <form ng-cloak>
          <md-toolbar>
            <div class="md-toolbar-tools">
              <h2>How to use QuickMeet</h2>
              <span flex></span>
              <md-button class="md-icon-button" ng-click="cancel()">
                <md-icon md-svg-src="img/icons/ic_close_24px.svg" aria-label="Close dialog"></md-icon>
              </md-button>
            </div>
          </md-toolbar>

          <md-dialog-content>
              <div class="md-dialog-content">
                  
                <link rel="stylesheet" href="css/help.css"></link>
                <div class="right">
                    <p>Login with a new username or an already existing username</p>
                </div> 
                <div>   
                  <img  src="img/login.gif" alt="login" title="login" />
                </div>
                <div class="right">
                    <p>Add or delete events to your calendar by clicking and dragging</p>
                </div>  
                <div>   
                  <img  src="img/addOrDelete.gif" alt="addOrDelete" title="addOrDelete" />
                </div>
                <div class="right">
                    <p>To create a group calendar, enter a group name and click the create group button</p>
                </div> 
                <div>   
                  <img  src="img/createGroup.gif" alt="createGroup" title="createGroup" />
                </div>
              </div>
          </md-dialog-content>

          <md-dialog-actions layout="row">
            <md-button ng-click="cancel()">
              Cancel
            </md-button>
          </md-dialog-actions>
        </form>
        
      </md-dialog>
      </script>


    <script> 
        var link = window.location.href.split("groupName=");
        var groupName = link[1];
        getUserTimesInGroup(groupName, startGroupUpload);</script>
      <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    <script>
  // Initialize Firebase--couldnt do in seperate file due to includes not working
  // TODO: Replace with your project's customized code snippet
  var loadedDB;
  var groupLoadedDB;
  setTimeout(returningGroupCreation,time20); 
  var config = {
    apiKey: "AIzaSyBetNrKXVXpI6OrSjOpwVIm_HQSZ0p64tw",
    authDomain: "quickmeet2-c69c9.firebaseapp.com",
    databaseURL: "https://quickmeet2-c69c9.firebaseio.com",
    storageBucket: "bkt1.appspot.com",
    messagingSenderId: "admin",
  };
  firebase.initializeApp(config);
  console.log("success");
    // Get a reference to the database service
    var database = firebase.database();

    function writeUserData() {
        //setTimeout(function(){
        var link = window.location.href.split("username=");
        var username = link[1];
        firebase.database().ref('user/'+username+'/').set(dataJSON);
        console.log("wrote user");
        //},time2);
    }   

    function readUserData(){
        
        var username;
        /*if (document.getElementById("name").value!= null){
           username =  document.getElementById("name").value;
        }else if (document.getElementById("name1").value!= null){
            username =  document.getElementById("name1").value;
        }
        GLOBALUserName = username;*/
        username = GLOBALUserName;
        return firebase.database().ref('user/'+username+'/').once('value').then(function(snapshot) {
        loadedDB = snapshot.val();
        console.log(loadedDB);
        });
        console.log("read user");
    }
        
    function readUserDataParam(userArray,callback){
        var userJSONArray  = [];
        //GLOBALUserName = username;
        //console.log("lenght of name array ",userArray);
        for(var userIndex = 1; userIndex < userArray.length; userIndex++){
                //console.log(userArray[userIndex])
                firebase.database().ref('user/'+userArray[userIndex]+'/').once('value').then(
                    function(snapshot) {
                        
                        var USERJSON = snapshot.val().users;
                        userJSONArray.push(USERJSON);
                        //console.log("users snap for user",userArray[userIndex], userJSONArray[0]);
                        //console.log(userJSONArray[userIndex]);
                });
            //console.log("index: ", userIndex,userJSONArray);
        }
        
        callback(userJSONArray,0,userArray.length);
        //console.log("read user:",    userJSONArray[0]);

        setTimeout(function(){
            //console.log("read user in timeout", userJSONArray[0]);
            return userJSONArray;},time2);
    }
   function writeGroupData() {
        var link = window.location.href.split("groupName=");
        var groupname = link[1];
        firebase.database().ref('groups/'+groupname+'/').set(groupDataJSON);
        console.log("wrote groups");
    }
    function readGroupData(){
        
        var link = window.location.href.split("groupName=");
        var groupname = link[1];
        
        return firebase.database().ref('groups/'+groupname+'/').once('value').then(function(snapshot) {
        groupLoadedDB = snapshot.val();
        console.log(groupLoadedDB);
        });
        console.log("read user");
    }
    </script>
<br><br><br>

</html>
